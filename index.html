<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>blacksun</title>
<style>
  /* Base styles */
  html, body {
    margin: 0; padding: 0;
    background: black;
    color: #00ff00;
    font-family: 'Courier New', monospace;
    height: 100vh;
    overflow: hidden;
  }
  body {
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #terminal {
    background: #000;
    border: 2px solid #00ff00;
    width: 90vw;
    max-width: 800px;
    height: 70vh;
    padding: 20px;
    box-sizing: border-box;
    overflow-y: auto;
    user-select: none;
  }

  #output {
    white-space: pre-wrap;
    line-height: 1.3;
  }

  #inputLine {
    display: flex;
  }

  #prompt {
    flex-shrink: 0;
    margin-right: 5px;
  }

  #cmdInput {
    flex-grow: 1;
    background: transparent;
    border: none;
    outline: none;
    color: #00ff00;
    font-family: monospace;
    font-size: 1rem;
  }

  /* Blinking cursor */
  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }
  #cmdInput::after {
    content: '_';
    animation: blink 1s step-start infinite;
  }
</style>
</head>
<body>
<div id="terminal" tabindex="0" aria-label="Terminal interface">
  <div id="output"></div>
  <div id="inputLine">
    <div id="prompt">&gt;</div>
    <input type="text" id="cmdInput" autocomplete="off" autofocus spellcheck="false" />
  </div>
</div>

<script>
(() => {
  const terminal = document.getElementById('terminal');
  const output = document.getElementById('output');
  const input = document.getElementById('cmdInput');

  // Hide blinking cursor on input to avoid confusion
  input.style.caretColor = '#00ff00';

  // Terminal state and prompts
  const steps = [
    {
      prompt: 'Define a variable named "flag" and assign it the number 1',
      validator: input => {
        // Accept e.g. flag=1 or flag = 1
        return /^\s*flag\s*=\s*1\s*;?\s*$/.test(input.toLowerCase());
      },
      success: 'Variable "flag" set. Proceeding...',
    },
    {
      prompt: 'Increment the variable "flag" by 4',
      validator: input => {
        // Accept: flag=flag+4 or flag+=4
        return /^\s*flag\s*=\s*flag\s*\+\s*4\s*;?\s*$/.test(input.toLowerCase()) ||
               /^\s*flag\s*\+=\s*4\s*;?\s*$/.test(input.toLowerCase());
      },
      success: 'flag incremented. Next step...',
    },
    {
      prompt: 'What is the value of "flag"? (Just enter the number)',
      validator: input => {
        return input.trim() === '5';
      },
      success: 'Correct. Preparing final step...',
    },
    {
      prompt: 'Enter the secret command to unlock the final screen: type "open sesame"',
      validator: input => {
        return input.trim().toLowerCase() === 'open sesame';
      },
      success: 'Access granted. Loading...',
      finalStep: true
    }
  ];

  let currentStep = 0;

  function appendOutput(text) {
    output.textContent += text + '\n';
    terminal.scrollTop = terminal.scrollHeight;
  }

  function showPrompt() {
    appendOutput('\n' + steps[currentStep].prompt);
  }

  function clearInput() {
    input.value = '';
  }

  function proceed() {
    currentStep++;
    if(currentStep < steps.length) {
      showPrompt();
    } else {
      // Finished all steps
      loadFinalPage();
    }
  }

  function loadFinalPage() {
    // Clear terminal and load the final image full screen
    document.body.innerHTML = '';
    const img = document.createElement('img');
    img.src = 'https://images.immediate.co.uk/production/volatile/sites/7/2019/12/80.-OPENER_-Founding-Fathers-5a352df.jpg?quality=90&resize=980,654';
    img.style.width = '100vw';
    img.style.height = '100vh';
    img.style.objectFit = 'contain';
    img.style.background = 'black';
    document.body.style.margin = '0';
    document.body.style.background = 'black';
    document.body.appendChild(img);
  }

  input.addEventListener('keydown', e => {
    if(e.key === 'Enter') {
      const val = input.value;
      appendOutput('> ' + val);
      if(steps[currentStep].validator(val)) {
        appendOutput(steps[currentStep].success);
        if(steps[currentStep].finalStep) {
          loadFinalPage();
          return;
        }
        proceed();
      } else {
        appendOutput('ERROR: Incorrect input. Try again.');
      }
      clearInput();
      e.preventDefault();
    }
  });

  // Initialize terminal
  appendOutput('Welcome to blacksun\n');
  showPrompt();

  // Focus input on load and click
  terminal.addEventListener('click', () => input.focus());
  window.addEventListener('load', () => input.focus());
})();
</script>
</body>
</html>
